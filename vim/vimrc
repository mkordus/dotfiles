" vi: fdm=marker

" Plugins: {{{
set nocompatible

filetype off "required by plugin manager

call plug#begin('~/.vim/plugged')

Plug 'mileszs/ack.vim'
Plug 'tpope/vim-vinegar'

Plug 'kien/ctrlp.vim'

Plug 'morhetz/gruvbox'

Plug 'tomtom/tcomment_vim'
" Plug 'tpope/vim-surround', { 'on': [] }
" Plug 'kien/rainbow_parentheses.vim', { 'for': ['php', 'sql']}

Plug 'szw/vim-ctrlspace'

Plug 'vim-scripts/dbext.vim', { 'for': ['php', 'sql']}
Plug 'scrooloose/syntastic', { 'for': ['php', 'javascript', 'python']}
Plug 'Valloric/YouCompleteMe', { 'on': [] }
Plug 'SirVer/ultisnips', { 'on': [] }
Plug 'honza/vim-snippets', { 'on': [] }
Plug 'tpope/vim-fugitive'
Plug 'majutsushi/tagbar'
Plug 'jiangmiao/auto-pairs'

Plug 'tpope/vim-git'
Plug 'othree/html5.vim'
Plug 'tpope/vim-markdown'
Plug 'StanAngeloff/php.vim'
Plug 'beyondwords/vim-twig'
Plug 'leshill/vim-json'
" Plug 'jelera/vim-javascript-syntax', { 'for': ['javascript']}
Plug 'andersoncustodio/vim-tmux'

"Plug 'exu/pgsql.vim', {'for': ['php', 'sql']}
Plug 'joonty/vdebug', {'for': ['php']}

Plug 'junegunn/vim-pseudocl'
Plug 'junegunn/vim-oblique'

Plug 'christoomey/vim-tmux-navigator'

"Plug 'AndrewRadev/linediff.vim'

call plug#end()

filetype plugin indent on

"lazy loading
augroup load_us_ycm
    autocmd!
    autocmd InsertEnter *
        \ call plug#load('ultisnips', 'vim-snippets', 'YouCompleteMe')
        \| call plug#load('vim-surround')
        \| call youcompleteme#Enable() | autocmd! load_us_ycm
augroup END

" }}}
" Settings: {{{

"main
set encoding=utf-8
set undolevels=1000
set showmatch
set showmode
set noshowcmd

let g:mapleader = "\<Space>"
inoremap jk <Esc>
inoremap kj <Esc>
nmap <leader>ev :edit $MYVIMRC<CR>
nmap <leader>ws :w !sudo tee %<CR>

set number
nnoremap <Leader>l :set nonumber!<CR>
set ttyfast

map j gj
map k gk

set splitbelow
set splitright

nmap <leader>h :noh<CR>

"command line mode
set wildmenu
set wildmode=longest:list,full
set wildignorecase
set wildignore+=*/.git/*,*/tmp/*,*/cache/*

"colors
syntax enable
colorscheme gruvbox
set background=dark
if !has('gui_running')
  set t_Co=256
endif

let loaded_matchparen = 0

"indent
set autoindent
set copyindent
set smartindent
set smarttab
set expandtab
set shiftwidth=4
set tabstop=4
set et

"gVim options
set guioptions-=T
set guioptions-=r
set guioptions-=L
set guioptions-=m
set guioptions-=e
set showtabline=1
set guifont=Liberation\ Mono\ for\ Powerline\ 11
set mousehide

"searching
set ignorecase
set smartcase
set incsearch
set magic

"Don't redraw while executing macros(performace)
set lazyredraw

"no anoying sound on errors
set noerrorbells
set novisualbell

"turn off backup
set nobackup
set noswapfile
set nowb

set lbr
set tw=500
set nowrap

set noruler

nnoremap <leader>v <C-w>v<C-w>l
nnoremap <leader>s <C-w>s

"speed up scrolling
set scrolljump=8

" Instead of 1 line, move 5 at a time
nnoremap <C-e> 5<C-e>
nnoremap <C-y> 5<C-y>

" wrapping lines in visual mode
vnoremap < <gv
vnoremap > >gv

" use system clipboard instead of default vim
set clipboard=unnamedplus

set gcr=a:block
set gcr+=a:blinkon0

set laststatus=2

" coments
hi Comment cterm=NONE

"visual
hi Visual cterm=NONE ctermbg=239

" fast windows close
inoremap <C-q> <esc>:q<cr>
nnoremap <C-q> :q<cr>

" sql
let g:php_sql_query=0

"select php heredoc
vnoremap ih <ESC>?<<<<CR>jV/SQL;<CR>k

set mouse=a

set listchars=tab:▸\ ,eol:¬
set list

set foldmethod=manual
"speed up YCM tags
set complete-=i
" }}}
" PluginsSettings {{{
" Vdebug
let g:vdebug_keymap = {
    \    "run" : "<F5>",
    \    "step_over" : "<F6>",
    \    "step_into" : "<F7>",
    \    "step_out" : "<F8>",
    \    "get_context" : "<F9>",
    \    "set_breakpoint" : "<F10>",
    \    "detach" : "<F11>",
    \    "close" : "<F12>",
    \    "eval_under_cursor" : "<Leader>euc",
    \    "run_to_cursor" : "<Leader>c",
    \    "eval_visual" : "<Leader>e",
    \}
let g:vdebug_options= {
    \    "port" : 9000,
    \    "server" : 'localhost',
    \    "timeout" : 60,
    \    "on_close" : 'detach',
    \    "break_on_open" : 0,
    \    "ide_key" : '',
    \    "path_maps" : {},
    \    "debug_window_level" : 0,
    \    "debug_file_level" : 0,
    \    "debug_file" : "",
    \    "watch_window_style" : 'compact',
    \    "marker_default" : '⬦',
    \    "marker_closed_tree" : '▸',
    \    "marker_open_tree" : '▾',
    \    "continuous_mode" : 1
    \}

" tagbar
nnoremap <leader>t :TagbarOpenAutoClose<CR>
let g:tagbar_width = 45

" YCM
set completeopt=menuone,longest
let g:ycm_complete_in_comments = 1
let g:ycm_complete_in_strings = 1
let g:ycm_collect_identifiers_from_comments_and_strings = 1
let g:ycm_collect_identifiers_from_tags_files = 1


"ultiSnips
let g:UltiSnipsSnippetDirectories = ["UltiSnips", "ultisnips-snippets"]
let g:UltiSnipsJumpForwardTrigger="<c-j>"
let g:UltiSnipsJumpBackwardTrigger = "<c-k>"
let g:UltiSnipsExpandTrigger="<S-CR>"

"fugitive
nnoremap <silent> <leader>gs :Gstatus<CR>
nnoremap <silent> <leader>gd :Gvdiff<CR>
nnoremap <silent> <leader>gb :Gblame<CR>

"ctrlP
let g:ctrlp_working_path_mode = 'rw'
nnoremap <Leader>b :CtrlPBuffer<CR>
nnoremap <C-T> :CtrlPSmartTabs<CR>

if executable('ag')
    let s:ctrlp_fallback = 'ag %s --nocolor -l -g ""'
elseif executable('ack-grep')
    let s:ctrlp_fallback = 'ack-grep %s --nocolor -f'
elseif executable('ack')
    let s:ctrlp_fallback = 'ack %s --nocolor -f'
else
    let s:ctrlp_fallback = 'find %s -type f'
endif

"syntastic
let g:syntastic_php_checkers = ['php']
let g:syntastic_check_on_open=0

" search vim-oblique
hi! def link ObliquePrompt       None
hi! def link ObliqueCurrentMatch Error

" }}}
" AutoCMSs: {{{
augroup filespecific
    autocmd!
    autocmd BufRead,BufNewFile *.md set filetype=markdown
    autocmd FileType sql,php,vim autocmd BufWritePre <buffer> :%s/\s\+$//e
augroup END

augroup Tmux "{{{
    autocmd!
    autocmd VimEnter,BufNewFile,BufReadPost * call system('tmux rename-window "vim - ' . split(substitute(getcwd(), $HOME, '~', ''), '/')[-1] . '"')
    autocmd VimLeave * call system('tmux rename-window ' . split(substitute(getcwd(), $HOME, '~', ''), '/')[-1])
augroup END
" }}}
" localConfig: {{{
if filereadable(expand('~/dotfiles/vim/vimrc.local'))
    source ~/dotfiles/vim/vimrc.local
endif
" }}}
