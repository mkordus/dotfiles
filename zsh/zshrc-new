# auto load
autoload -U compinit zsh-mime-setup promptinit colors
compinit
promptinit
colors
zsh-mime-setup

# options
zstyle ':completion::complete:*' use-cache on
zstyle ':completion::complete:*' cache-path ~/.zsh/cache
zstyle ':completion:*' menu select=2
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
zstyle ':completion:*' verbose yes

# history
HISTFILE=~/.zsh_history
HISTSIZE=1024
SAVEHIST=1024
setopt append_history
setopt hist_ignore_all_dups
setopt hist_reduce_blanks
setopt inc_append_history
setopt share_history

# other
unsetopt beep
unsetopt bg_nice
unsetopt hist_beep
unsetopt hup
unsetopt list_beep
unsetopt rm_star_silent

setopt list_ambiguous

export EDITOR='vim'

#vi-mode
bindkey -v
bindkey -M viins 'jk' vi-cmd-mode
bindkey "^P" up-line-or-search
bindkey "^N" down-line-or-search

# prompt
function precmd {
    PATH_VIEW="$(echo ${(%):-%~})"

    if git rev-parse --git-dir > /dev/null 2>&1; then
        GIT_VIEW="$(basename $(readlink -f ./$(git rev-parse --show-cdup)))"
        #PATH_VIEW="$(echo ${PATH_VIEW} | sed 's/'${GIT_VIEW}'/%B'${GIT_VIEW}'%b/')"
        GIT_BRANCH="$(git rev-parse --symbolic-full-name --abbrev-ref HEAD)"
        GIT_BRANCH_VIEW=" %F{cyan}(${GIT_BRANCH})%f"
    else
        GIT_BRANCH_VIEW=''
    fi
    PROMPT="${NEW_LINE}%B%F{green}${PATH_VIEW}%f%b${GIT_BRANCH_VIEW}${NEW_LINE}${INSERT_MODE} "
}
NEW_LINE=$'\n'
INSERT_MODE="%B%F{red}❯%F{yellow}❯%F{green}❯%f%b"
NORMAL_MODE="%B%F{green}❮%F{yellow}❮%F{red}❮%f%b"

alias tmux="TERM=screen-256color-bce tmux"
alias ls='ls --color=auto'

DIRSTACKSIZE=50
setopt auto_pushd # Make cd push the old directory onto the directory stack.
setopt pushd_ignore_dups # Ignore duplicates at the directory stack.
setopt pushd_minus # makes the whole pushd list easier to use from 'cd'
setopt pushd_silent # dont talk on start

function cdp {
    cd $(dirs -pl | tac | fzf)
}

function loadDirstack {
    local DIRSTACK_PATH="$(cd; pwd)/.dirstack"
    if [[ -a "$DIRSTACK_PATH" ]]; then
        local CURRENT_PATH="$(pwd)"

        for i in $(cat "$DIRSTACK_PATH"); do 
            pushd $i; 
        done

        cd $CURRENT_PATH
    fi
}

loadDirstack



# fzf
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
